(function($){$(document).ready(function(){uucss_global.home_url="https://www.marketwatch.com/";var $onboard_menu=$(".rapidload-on-board-new .menu-section .menu-list");var progress_check=null;var popupWindow=null;var ajax_pending=null;var purging_in_progress=false;var second_attempt=false;$("a.connect-with-license").click(function(e){e.preventDefault()});function closePopWindow(){if(popupWindow){popupWindow.close();popupWindow=null}}function child_open(url,width=770,height=590){if(popupWindow&&!popupWindow.closed){popupWindow.focus()}else{var left=$(window).width()/2-width/2;var top=$(window).height()/2-height/2;popupWindow=window.open(url,"_blank","directories=no, status=no, menubar=no, scrollbars=yes, resizable=no, width="+width+", height="+height+",  top="+top+", left="+left);$(window).bind("beforeunload",function(){popupWindow=null});popupWindow.focus()}}function purge_url(url){if(purging_in_progress){return}$.ajax({method:"POST",url:wp.ajax.settings.url+"?action=uucss_purge_url",data:{url:url,nonce:uucss_global.nonce},beforeSend:function(){purging_in_progress=true},success:function(response){if(!progress_check){progress_check=setInterval(checkRapidLoadConfigured,1e3)}}})}function getMetrixSpec(score){if(score!==0&&!score){return{color:"#ffffff",color_name:"white",shape:"blank"}}else if(!score||score<=.49&&score>=0){return{color:"#fe3333",color_name:"red",shape:"triangle"}}else if(score>=.5&&score<=.89){return{color:"#feaa33",color_name:"yellow",shape:"square"}}else{return{color:"#04cc66",color_name:"green",shape:"circle"}}}function validate_url(url){wp.ajax.post("uucss_test_url",{url:url,include_matrix:true}).then(function(i){console.log(i);$onboard_menu.find(".menu-item").removeClass("active");$onboard_menu.find(".menu-item.forth").addClass("active");var $score_matix=$(".page-speed-score-section");if(i.page_matrix&&i.page_matrix.lighthouseResult){if(i.page_matrix.lighthouseResult.categories&&i.page_matrix.lighthouseResult.categories.performance){$score_matix.find(".score-image-section .score-bar .score").html("<p>"+i.page_matrix.lighthouseResult.categories.performance.score*100+"</p>")}$score_matix.find(".score-image-section img.final-screenshot").attr("src","//image.thum.io/get/auth/14534-rapidload-analyzer/width/600/crop/800/"+uucss_global.home_url);var audits=i.page_matrix.lighthouseResult.audits;var audit_keys=Object.keys(audits);audit_keys.forEach(function(value,index){audits[value].metrix=getMetrixSpec(audits[value].score)});if(audits["first-contentful-paint"]){$(".page-speed-score-section").find(".score-matrix-section .score-matrix.matrix-fcp .score").text(audits["first-contentful-paint"].displayValue);$(".page-speed-score-section .score-matrix-section .score-matrix.matrix-fcp span.icon-shape").addClass(audits["first-contentful-paint"].metrix.shape);$(".page-speed-score-section .score-matrix-section .score-matrix.matrix-fcp span.score").addClass(audits["first-contentful-paint"].metrix.shape)}if(audits["interactive"]){$(".page-speed-score-section").find(".score-matrix-section .score-matrix.matrix-time-interactive .score").text(audits["interactive"].displayValue);$(".page-speed-score-section .score-matrix-section .score-matrix.matrix-time-interactive span.icon-shape").addClass(audits["first-contentful-paint"].metrix.shape);$(".page-speed-score-section .score-matrix-section .score-matrix.matrix-time-interactive span.score").addClass(audits["first-contentful-paint"].metrix.shape)}if(audits["speed-index"]){$(".page-speed-score-section").find(".score-matrix-section .score-matrix.matrix-speed-index .score").text(audits["speed-index"].displayValue);$(".page-speed-score-section .score-matrix-section .score-matrix.matrix-speed-index span.icon-shape").addClass(audits["first-contentful-paint"].metrix.shape);$(".page-speed-score-section .score-matrix-section .score-matrix.matrix-speed-index span.score").addClass(audits["first-contentful-paint"].metrix.shape)}if(audits["total-blocking-time"]){$(".page-speed-score-section").find(".score-matrix-section .score-matrix.matrix-blocking-time .score").text(audits["total-blocking-time"].displayValue);$(".page-speed-score-section .score-matrix-section .score-matrix.matrix-blocking-time span.icon-shape").addClass(audits["first-contentful-paint"].metrix.shape);$(".page-speed-score-section .score-matrix-section .score-matrix.matrix-blocking-time span.score").addClass(audits["first-contentful-paint"].metrix.shape)}if(audits["largest-contentful-paint"]){$(".page-speed-score-section").find(".score-matrix-section .score-matrix.matrix-lcp .score").text(audits["largest-contentful-paint"].displayValue);$(".page-speed-score-section .score-matrix-section .score-matrix.matrix-lcp span.icon-shape").addClass(audits["first-contentful-paint"].metrix.shape);$(".page-speed-score-section .score-matrix-section .score-matrix.matrix-lcp span.score").addClass(audits["first-contentful-paint"].metrix.shape)}if(audits["cumulative-layout-shift"]){$(".page-speed-score-section").find(".score-matrix-section .score-matrix.matrix-cls .score").text(audits["cumulative-layout-shift"].displayValue);$(".page-speed-score-section .score-matrix-section .score-matrix.matrix-cls span.icon-shape").addClass(audits["first-contentful-paint"].metrix.shape);$(".page-speed-score-section .score-matrix-section .score-matrix.matrix-cls span.score").addClass(audits["first-contentful-paint"].metrix.shape)}}var oppportunity=[];var debugdata=[];var types=[];var passedaudits=[];audit_keys.forEach(function(value,index){if(audits[value].details&&audits[value].details.type){types.push(audits[value].details.type)}if(audits[value].score>=0&&audits[value].score<=.89&&audits[value].details&&audits[value].details.type==="opportunity"){oppportunity.push(audits[value])}if(audits[value].score>=0&&audits[value].score<=.89&&audits[value].details&&audits[value].details.type==="table"){debugdata.push(audits[value])}if(audits[value].score>=.9&&audits[value].details&&audits[value].details.type==="opportunity"){passedaudits.push(audits[value])}});debugdata=debugdata.filter(function(value){return value!==null}).sort((a,b)=>{var a_score=a.score;var b_score=b.score;if(a_score!==0&&!a_score){a_score=1}if(b_score!==0&&!b_score){b_score=1}return a_score>b_score?1:-1});oppportunity=oppportunity.sort((a,b)=>{var a_score=a.score;var b_score=b.score;if(a_score!==0&&!a_score){a_score=1}if(b_score!==0&&!b_score){b_score=1}return a_score>b_score?1:-1});var $opportunities=$("ul.opportunities-list-items");oppportunity.forEach(function(value){var $listitem=$("<div></div>");$listitem.append('<li><div class="metrix-title"></div><div class="metrix-detail" style="display: none"></div></li>');$listitem.find("li div.metrix-title").append('<span><span class="'+value.metrix.shape+'"><span class="dashicons dashicons-controls-play"></span></span><span>'+value.title+"</span></span>");$listitem.find("li div.metrix-title").append("<span><span>"+(value.numericValue?Number(value.numericValue/1e3).toFixed(2)+"s":"")+'</span><span class="dashicons dashicons-arrow-down-alt2 toggle-metrix"></span></span>');$listitem.find("li div.metrix-detail").append("<p>"+value.description+"</p>");var headings=[];if(value.details&&value.details.headings){$listitem.find("li div.metrix-detail").append("<table></table>");var $row=$("<div></div>");$row.append("<tr></tr>");value.details.headings.forEach(function(heading){headings.push(heading);$row.find("tr").append("<th>"+(heading.label?heading.label:heading.key)+"</th>")});$listitem.find("table").append($row.wrap("<div></div>").html())}if(value.details&&value.details.items){value.details.items.forEach(function(item,index){var $row=$("<div></div>");$row.append("<tr></tr>");headings.forEach(function(heading){var data="";if(heading.valueType==="text"||heading.valueType==="url"){data=item[heading.key]}else if(heading.valueType==="ms"||heading.valueType==="timespanMs"){data=Number(item[heading.key]/1e3).toFixed(2)+"s"}else if(heading.valueType==="bytes"){data=Number(item[heading.key]/1024).toFixed(2)+"KB"}$row.find("tr").append("<td>"+data+"</td>")});$listitem.find("table").append($row.wrap("<div></div>").html())})}$opportunities.append($listitem.wrap("<div></div>").html())});var $diagnostics=$("ul.diagnostics-list-items");debugdata.forEach(function(value){var $listitem=$("<div></div>");$listitem.append('<li><div class="metrix-title"></div><div class="metrix-detail" style="display: none"></div></li>');$listitem.find("li div.metrix-title").append('<span><span class="'+value.metrix.shape+'"><span class="dashicons dashicons-controls-play"></span></span><span>'+value.title+"</span></span>");$listitem.find("li div.metrix-title").append("<span><span>"+(value.displayValue?value.displayValue:"")+'</span><span class="dashicons dashicons-arrow-down-alt2 toggle-metrix"></span></span>');$listitem.find("li div.metrix-detail").append("<p>"+value.description+"</p>");$diagnostics.append($listitem.wrap("<div></div>").html());var headings=[];if(value.details&&value.details.headings){$listitem.find("li div.metrix-detail").append("<table></table>");var $row=$("<div></div>");$row.append("<tr></tr>");value.details.headings.forEach(function(heading){headings.push(heading);$row.find("tr").append("<th>"+(heading.label?heading.label:heading.key)+"</th>")});$listitem.find("table").append($row.wrap("<div></div>").html())}});var $passedaudits=$("ul.passed-audits-list-items");passedaudits.forEach(function(value){var $listitem=$("<div></div>");$listitem.append('<li><div class="metrix-title"></div><div class="metrix-detail" style="display: none"></div></li>');$listitem.find("li div.metrix-title").append('<span><span class="'+value.metrix.shape+'"><span class="dashicons dashicons-controls-play"></span></span><span>'+value.title+"</span></span>");$listitem.find("li div.metrix-title").append("<span><span>"+(value.displayValue?value.displayValue:"")+'</span><span class="dashicons dashicons-arrow-down-alt2 toggle-metrix"></span></span>');$listitem.find("li div.metrix-detail").append("<p>"+value.description+"</p>");$passedaudits.append($listitem.wrap("<div></div>").html())});$("ul li .metrix-title .dashicons").click(function(){$(this).parent().parent().parent().find(".metrix-detail").slideToggle()});$(".action-section.forth-step div div.action-section-content-success").removeClass("hidden");$(".action-section").addClass("hidden");$(".action-section.forth-step").removeClass("hidden")}).failed(function(i){console.log(i)})}function apply_and_validate(url){wp.ajax.post("clear_page_cache",{url:url}).then(function(i){validate_url(url)})}function checkRapidLoadConfigured(){if(popupWindow&&popupWindow.closed){clearInterval(progress_check);return}if(ajax_pending){return}$.ajax({url:uucss_global.ajax_url,type:"GET",data:{action:"rapidload_connected"},beforeSend:function(){ajax_pending=true},complete:function(){ajax_pending=false},success:function(response){if(response.data){if(response.data.rapidload_connected&&(!response.data.first_job||["processing","queued"].includes(response.data.first_job.status))){closePopWindow();if(!purging_in_progress){$onboard_menu.find(".menu-item").removeClass("active");$onboard_menu.find(".menu-item.second").addClass("active");$(".action-section").addClass("hidden");$(".action-section.loading").removeClass("hidden");purge_url(uucss_global.home_url)}}else if(response.data.rapidload_connected&&response.data.first_job&&!["processing","queued"].includes(response.data.first_job.status)){closePopWindow();$onboard_menu.find(".menu-item").removeClass("active");$onboard_menu.find(".menu-item.third").addClass("active");clearInterval(progress_check);if(response.data.first_job.status==="failed"){$onboard_menu.find(".menu-item").removeClass("active");$onboard_menu.find(".menu-item.forth").addClass("active");$(".action-section.forth-step div div.action-section-content-failed div pre code").text(JSON.stringify(response.data.first_job,undefined,2));$(".action-section").addClass("hidden");$(".action-section.forth-step div div.action-section-content-failed").removeClass("hidden");$(".action-section.forth-step").removeClass("hidden")}else if(response.data.first_job.status==="success"){apply_and_validate(uucss_global.home_url)}}else{$(".action-section").addClass("hidden");$(".action-section.first-step").removeClass("hidden")}}}})}tippy("a.connect-with-license",{allowHTML:true,arrow:false,appendTo:$("a.connect-with-license")[0],interactive:true,animation:"shift-toward",placement:"top-start",trigger:"click",hideOnClick:false,theme:"light",maxWidth:500,onClickOutside(instance,event){instance.hide()},content:function(){var content;content='<div class="tippy-connect-with-license">'+'               <div class="tippy-connect-with-license-content">'+'                   <div class="header-text">'+"                       <p>Enter your License Key below</p>"+"                   </div>"+'                   <div class="input-wrap">'+'                       <input type="text"  placeholder="License Key" class="uucss-key">'+'                       <a href="#" class="connect">Connect</a>'+"                   </div>"+'                   <div><p class="uucss-key-error"></p></div>'+"               </div>"+"          </div>";return content},onMount(instance){$("a.connect-with-license .tippy-connect-with-license-content input.uucss-key").focus();$("a.connect-with-license .tippy-connect-with-license-content .input-wrap .connect").click(function(e){e.preventDefault();var license_key=$("a.connect-with-license .tippy-connect-with-license-content .input-wrap input").val();if(license_key===""){$.uucssAlert("Please enter a license key","error");return}var $target=$(this);$target.text("Connecting...");$target.removeAttr("href");wp.ajax.post("uucss_connect",{license_key:license_key}).then(function(i){if(i.success){window.location.href=window.location.href+"&token="+license_key+"&nonce="+i.activation_nonce}}).fail(function(i){$target.text("Connect");$target.attr("href","#");$("a.connect-with-license p.uucss-key-error").text(i)})})}});$("a.connect").click(function(e){e.preventDefault();child_open($(this).attr("href"));clearInterval(progress_check);progress_check=setInterval(checkRapidLoadConfigured,1e3)});checkRapidLoadConfigured()})})(jQuery);